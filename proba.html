<!DOCTYPE html>
<html>
  <head>
    <script src="https://www.gstatic.com/firebasejs/7.17.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.17.1/firebase-database.js"></script>
    <script>
      
   var firebaseConfig = {
		apiKey: "AIzaSyBB00grLIfvhq7EEQV6qiZUZuayP4-GoAg",
		authDomain: "blog-25253.firebaseapp.com",
		databaseURL: "https://blog-25253-default-rtdb.europe-west1.firebasedatabase.app",
		projectId: "blog-25253",
		storageBucket: "blog-25253.appspot.com",
		messagingSenderId: "906101390805",
		appId: "1:906101390805:web:871c51f2486921f443115c",
		measurementId: "G-MY3P2TWN4L"
	};

firebase.initializeApp(firebaseConfig);
var database = firebase.database();


document.addEventListener("keydown", function(event) {
	if (event.keyCode === 13) {
		event.preventDefault();
		submitLink();
	}
});


function submitLink() {
	var linkName = document.getElementById("linkName").value;
	var linkUrl = document.getElementById("linkUrl").value;

	if (!linkName || !linkUrl) {
		document.getElementById("errorMessage").innerHTML = "Both the link name and URL are required";
		return;
	}

	document.getElementById("errorMessage").innerHTML = "";
	document.getElementById("successMessage").innerHTML = "";
	var linksRef = database.ref("links");

	linksRef.orderByChild("id").limitToLast(1).once("value", function(snapshot) {
		var newId = 0;
		snapshot.forEach(function(childSnapshot) {
			var childData = childSnapshot.val();
			if (childData.id > newId) {
				newId = childData.id;
			}
		});
		newId++;

		linksRef.child(linkName).set({
			id: newId,
			url: linkUrl,
			timestamp: firebase.database.ServerValue.TIMESTAMP
		});

		document.getElementById("successMessage").innerHTML = "Link submitted successfully";
		document.getElementById("linkName").value = "";
		document.getElementById("linkUrl").value = "";
	});
}

function clearForm() {
	document.getElementById("errorMessage").innerHTML = "";
	document.getElementById("successMessage").innerHTML = "";
}

function clearName() {
	document.getElementById("linkName").value = "";
}

function clearUrl() {
	document.getElementById("linkUrl").value = "";
}


document.addEventListener("keydown", function(event) {
	if (event.keyCode === 46) {
		event.preventDefault();
		deleteLink();
	}
});

function deleteLink() {
	var linkName = document.getElementById("linkName").value;
	var linkUrl = document.getElementById("linkUrl").value;



	if (linkName && linkUrl && linkName === linkUrl) {
		document.getElementById("errorMessage").innerHTML = "The link name and URL are the same";
		return;
	}

	if (!linkName) {
		document.getElementById("errorMessage").innerHTML = "Link name is required";
		return;
	}

	document.getElementById("errorMessage").innerHTML = "";
	document.getElementById("successMessage").innerHTML = "";


	var linkRef = firebase.database().ref("links").child(linkName);

	linkRef.once("value", (snapshot) => {
		const link = snapshot.val();

		if (link === null) {
			document.getElementById("errorMessage").innerHTML = "Link not found in the database";
		} else {
			linkRef.remove();
			document.getElementById("successMessage").innerHTML = "Link deleted successfully";
			document.getElementById("linkName").value = "";
			document.getElementById("linkUrl").value = "";
		}
	});
}

// Add event listener to document to detect "Ctrl + R" key combination    
document.addEventListener("keydown", function(event) {
	if (event.ctrlKey && event.keyCode === 82) { // "Ctrl + R"
		event.preventDefault();
		resetInputs();
	}
});

// Reset input fields function     
function resetInputs() {
	document.getElementById("linkName").value = "";
	document.getElementById("linkUrl").value = "";
	document.getElementById("successMessage").innerHTML = "";
	document.getElementById("errorMessage").innerHTML = "";
}
	    
	    
function toggleLinks() {
  var linkContainer = document.getElementById("linkContainer");
  if (linkContainer.style.display === "none") {
    linkContainer.style.display = "block";
    getLinks();
    document.getElementById("deleteSelectedBtn").addEventListener("click", function() {
      var linkList = document.getElementById("linkList");
      var checkboxes = linkList.getElementsByTagName("input");
	    
      if (checkedCheckboxes.length === 0) {
        document.getElementById("errorMessage").innerHTML = "You need to select at least one checkbox";
	return;
      }
	    
      for (var i = 0; i < checkboxes.length; i++) {
        if (checkboxes[i].checked) { 
          database.ref("links").child(checkboxes[i].id).remove();
          checkboxes[i].parentNode.remove(); // Remove checkbox from the DOM
        }
      }
    });
  } else {
    linkContainer.style.display = "none";
  }
}

function getLinks() {
  var linksRef = database.ref("links");
  linksRef.once("value", function(snapshot) {
    var linkList = document.getElementById("linkList");
    linkList.innerHTML = "";
    snapshot.forEach(function(childSnapshot) {
      var linkName = childSnapshot.key;
      linkList.innerHTML += `
        <div>
          <input type="checkbox" id="${linkName}" name="linkCheckbox" />
          <label for="${linkName}">${linkName}</label>
        </div>
      `;	        
    });
  });
}

document.getElementById("deleteSelectedBtn").addEventListener("click", function() {
  var linkList = document.getElementById("linkList");
  var checkboxes = linkList.getElementsByTagName("input");
  for (var i = 0; i < checkboxes.length; i++) {
    if (checkboxes[i].checked) {
      database.ref("links").child(checkboxes[i].id).remove();
    }
  }
});
   
	    
 </script>
  </head>
  <body>
    <input type="text" id="linkName" placeholder="Link Name" onfocus="clearForm();clearName();">
    <input type="text" id="linkUrl" placeholder="Link URL" onfocus="clearForm();clearUrl();">
    <div id="errorMessage" style="color: red;"></div>
    <div id="successMessage" style="color: green;"></div>
    <button onclick="submitLink()">Submit</button>
    <button onclick="deleteLink()">Delete</button>
    <button id="toggleButton" onclick="toggleLinks()">Toggle Links</button>
    <div id="linkContainer" style="display: none;">
    <div id="linkList"></div>
    <button id="deleteSelectedBtn">Delete Selected</button>
    </div>
  </body>
</html> 
