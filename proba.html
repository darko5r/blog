<!DOCTYPE html>
<html>
  <head>
    <script src="https://www.gstatic.com/firebasejs/7.17.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.17.1/firebase-database.js"></script>
    <script>
      
   var firebaseConfig = {
		apiKey: "AIzaSyBB00grLIfvhq7EEQV6qiZUZuayP4-GoAg",
		authDomain: "blog-25253.firebaseapp.com",
		databaseURL: "https://blog-25253-default-rtdb.europe-west1.firebasedatabase.app",
		projectId: "blog-25253",
		storageBucket: "blog-25253.appspot.com",
		messagingSenderId: "906101390805",
		appId: "1:906101390805:web:871c51f2486921f443115c",
		measurementId: "G-MY3P2TWN4L"
	};

firebase.initializeApp(firebaseConfig);
var database = firebase.database();


document.addEventListener("keydown", function(event) {
	if (event.keyCode === 13) {
		event.preventDefault();
		submitLink();
	}
});


function submitLink() {
	var linkName = document.getElementById("linkName").value;
	var linkUrl = document.getElementById("linkUrl").value;

	if (!linkName || !linkUrl) {
		document.getElementById("errorMessage").innerHTML = "Both the link name and URL are required";
		return;
	}

	document.getElementById("errorMessage").innerHTML = "";
	document.getElementById("successMessage").innerHTML = "";
	var linksRef = database.ref("links");

	linksRef.orderByChild("id").limitToLast(1).once("value", function(snapshot) {
		var newId = 0;
		snapshot.forEach(function(childSnapshot) {
			var childData = childSnapshot.val();
			if (childData.id > newId) {
				newId = childData.id;
			}
		});
		newId++;

		linksRef.child(linkName).set({
			id: newId,
			url: linkUrl,
			timestamp: firebase.database.ServerValue.TIMESTAMP
		});

		document.getElementById("successMessage").innerHTML = "Link submitted successfully";
		document.getElementById("linkName").value = "";
		document.getElementById("linkUrl").value = "";
	});
}

function clearForm() {
	document.getElementById("errorMessage").innerHTML = "";
	document.getElementById("successMessage").innerHTML = "";
}

function clearName() {
	document.getElementById("linkName").value = "";
}

function clearUrl() {
	document.getElementById("linkUrl").value = "";
}


document.addEventListener("keydown", function(event) {
	if (event.keyCode === 46) {
		event.preventDefault();
		deleteLink();
	}
});

function deleteLink() {
	var linkName = document.getElementById("linkName").value;
	var linkUrl = document.getElementById("linkUrl").value;



	if (linkName && linkUrl && linkName === linkUrl) {
		document.getElementById("errorMessage").innerHTML = "The link name and URL are the same";
		return;
	}

	if (!linkName) {
		document.getElementById("errorMessage").innerHTML = "Link name is required";
		return;
	}

	document.getElementById("errorMessage").innerHTML = "";
	document.getElementById("successMessage").innerHTML = "";


	var linkRef = firebase.database().ref("links").child(linkName);

	linkRef.once("value", (snapshot) => {
		const link = snapshot.val();

		if (link === null) {
			document.getElementById("errorMessage").innerHTML = "Link not found in the database";
		} else {
			linkRef.remove();
			document.getElementById("successMessage").innerHTML = "Link deleted successfully";
			document.getElementById("linkName").value = "";
			document.getElementById("linkUrl").value = "";
		}
	});
}

// Add event listener to document to detect "Ctrl + R" key combination    
document.addEventListener("keydown", function(event) {
	if (event.ctrlKey && event.keyCode === 82) { // "Ctrl + R"
		event.preventDefault();
		resetInputs();
	}
});

// Reset input fields function     
function resetInputs() {
	document.getElementById("linkName").value = "";
	document.getElementById("linkUrl").value = "";
	document.getElementById("successMessage").innerHTML = "";
	document.getElementById("errorMessage").innerHTML = "";
}
	    
	    
var menuExpanded = false;

  function toggleMenu() {
    var toggleMenu = document.getElementById("toggle-menu");
    var toggleButton = document.getElementById("toggle-button");

    if (menuExpanded) {
      toggleMenu.style.display = "none";
      toggleButton.textContent = "➕";
    } else {
      toggleMenu.style.display = "block";
      toggleButton.textContent = "➖";
    }

    menuExpanded = !menuExpanded;
  }

  document.getElementById("toggle-button").addEventListener("click", toggleMenu);
  document.getElementById("toggle-menu").style.display = "none";

      // firebase event listener
      
      database.ref("links").on("value", function(snapshot) {
  var links = snapshot.val();
  var linkList = document.getElementById("link-list");
  linkList.innerHTML = "";
  for (var link in links) {
  linkList.innerHTML += `
    <div>
      <input type="checkbox" id="${link}">
      <label for="${link}">${link} (${links[link].url})</label>
    </div>
  `;
}             
});

document.getElementById("delete-selected-links").addEventListener("click", function() {
  var linkList = document.getElementById("link-list");
  var checkboxes = linkList.getElementsByTagName("input");
  for (var i = 0; i < checkboxes.length; i++) {
    if (checkboxes[i].checked) {
      database.ref("links").child(checkboxes[i].id).remove();
    }
  }
});
      // delete selected links button event listener


      
 </script>
  </head>
  <body>
    <style>
    #toggle-button:hover {
      transform: rotate(360deg);
      transition: transform 0.3s ease-in-out;
    }
    </style>	  
    <input type="text" id="linkName" placeholder="Link Name" onfocus="clearForm();clearName();">
    <input type="text" id="linkUrl" placeholder="Link URL" onfocus="clearForm();clearUrl();">
    <div id="errorMessage" style="color: red;"></div>
    <div id="successMessage" style="color: green;"></div>
    <button onclick="submitLink()">Submit</button>
    <button onclick="deleteLink()">Delete</button>
   <!-- <button id="toggleButton" onclick="toggleLinks()">Toggle Links</button>
    <div id="linkContainer" style="display: none;">
    <div id="linkList"></div>
    <button id="deleteSelectedBtn">Delete Selected</button> -->
    <div><p>Toggle Links:<button id="toggle-button" style="border: none; background-color: transparent; font-weight: bold; font-size: 16px;" onMouseOver="this.style.color='#ec2f2f'" onMouseOut="this.style.color='#212020'">➕</button></p></div>
    <div id="toggle-menu" class="toggle-menu" style="border: none; background-color: transparent;">
    <div id="link-list"></div>
    <button id="delete-selected-links">Delete Selected</button>
    <button id="update-selected-links">Update Selected</button>  
    </div>	  
    </div>
  </body>
</html>
