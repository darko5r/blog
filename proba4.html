<html>
  <head>
    <script src="https://www.gstatic.com/firebasejs/7.17.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.17.1/firebase-database.js"></script>
    <script type='text/javascript' src='config.js'></script>      
  </head>

  <body>
    <form id="myForm">
  <input type="text" id="linkName" name="linkName" placeholder="Link Name" onfocus="clearForm();clearName();">
  <input type="text" id="linkUrl" name="linkUrl" placeholder="Link URL" onfocus="clearForm();clearUrl();">
  <div id="errorMessage" style="color: red;"></div>
  <div id="successMessage" style="color: green;"></div>
  <button id="myBtn" onclick="submitLink()">Submit</button>
  <button id="updateBtn" style="display: none;" onclick="updateLink()">Update</button>
  <button id="cancelBtn" style="display: none;" onclick="cancelEdit()">Cancel</button>
</form>

      
      <script>          
      // <script type="module">
      // Your web app's Firebase configuration
      // import { firebaseConfig } from 'config.js';
      // Initialize Firebase
      firebase.initializeApp(firebaseConfig);
      // firebase.analytics(); 
      
      // firebase.initializeApp(firebaseConfig);
      var database = firebase.database();
                    
    document.getElementById("myForm").addEventListener("submit", function(event) {
      event.preventDefault();
      submitLink();
     });

    function submitLink() {
       var linkName = encodeURIComponent(document.getElementById("linkName").value);
       var linkUrl = encodeURIComponent(document.getElementById("linkUrl").value);

    if (!linkName || !linkUrl) {
       document.getElementById("errorMessage").innerHTML = "Both the link name and URL are required";
       return;
     }

    document.getElementById("errorMessage").innerHTML = "";
    document.getElementById("successMessage").innerHTML = "";
    var linksRef = database.ref("links");

    linksRef.orderByChild("id").limitToLast(1).once("value", function(snapshot) {
      var newId = 0;
      snapshot.forEach(function(childSnapshot) {
        var childData = childSnapshot.val();
        if (childData.id > newId) {
          newId = childData.id;
        }
      });
      newId++;
      linksRef.child(linkName).set({
        id: newId,
        url: linkUrl,
        timestamp: firebase.database.ServerValue.TIMESTAMP
      });
      document.getElementById("successMessage").innerHTML = "Link submitted successfully";
      document.getElementById("linkName").value = "";
      
      document.getElementById("linkName").value = "";
document.getElementById("linkUrl").value = "";

var linkId;

// Add the update button
var updateButton = document.createElement("button");
updateButton.innerHTML = "Update";
updateButton.id = "updateBtn";
updateButton.style.display = "none";
updateButton.onclick = function() {
  updateLink();
};
document.getElementById("myForm").appendChild(updateButton);

// Add the cancel button
var cancelButton = document.createElement("button");
cancelButton.innerHTML = "Cancel";
cancelButton.id = "cancelBtn";
cancelButton.style.display = "none";
cancelButton.onclick = function() {
  cancelUpdate();
};
document.getElementById("myForm").appendChild(cancelButton);

// Function to update a link
function updateLink() {
  var linkName = encodeURIComponent(document.getElementById("linkName").value);
  var linkUrl = encodeURIComponent(document.getElementById("linkUrl").value);

  if (!linkName || !linkUrl) {
    document.getElementById("errorMessage").innerHTML = "Both the link name and URL are required";
    return;
  }

  document.getElementById("errorMessage").innerHTML = "";
  document.getElementById("successMessage").innerHTML = "";
  var linksRef = database.ref("links");
  linksRef.child(linkName).update({
    id: linkId,
    url: linkUrl,
    timestamp: firebase.database.ServerValue.TIMESTAMP
  });
  document.getElementById("successMessage").innerHTML = "Link updated successfully";
  document.getElementById("linkName").value = "";
  document.getElementById("linkUrl").value = "";
  document.getElementById("myBtn").style.display = "inline-block";
  document.getElementById("updateBtn").style.display = "none";
  document.getElementById("cancelBtn").style.display = "none";
}

// Function to cancel the update
function cancelUpdate() {
  document.getElementById("linkName").value = "";
  document.getElementById("linkUrl").value = "";
  document.getElementById("myBtn").style.display = "inline-block";
  document.getElementById("updateBtn").style.display = "none";
  document.getElementById("cancelBtn").style.display = "none";
}

      // Function to edit a link
function editLink(id, name, url) {
  linkId = id;
  document.getElementById("linkName").value = decodeURIComponent(name);
  document.getElementById("linkUrl").value = decodeURIComponent(url);
  document.getElementById("myBtn").style.display = "none";
  document.getElementById("updateBtn").style.display = "inline-block";
  document.getElementById("cancelBtn").style.display = "inline-block";
}
      
       linksRef.child(name).update({
        id: id,
        url: url,
        timestamp: firebase.database.ServerValue.TIMESTAMP
    });
        
  
  </script>    
  </body>
</html> 
